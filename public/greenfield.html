
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Greenfield Private University</title>
<link rel="stylesheet" href="assets/style.css"/>
</head>
<body>
  <div class="container">
    <header class="header card">
      <h1>Greenfield Private University</h1>
      <p class="small">A modern university focused on technology and design.</p>
    </header>

    <main class="grid">
      <section class="card">
        <h2>Overview</h2>
        <p id="overview">Loading...</p>

        <h3>Courses</h3>
        <ul id="coursesList"></ul>

        <p>
          <a class="btn" id="feesBtn">Check Course-wise Fees</a>
          <a class="btn" id="downloadBrochure" href="#">Download Brochure</a>
        </p>

        <h3>Placements</h3>
        <p id="placements"></p>

        <h3>Facilities</h3>
        <p id="facilities"></p>
      </section>

      <aside class="card">
        <h3>Apply / Get Brochure</h3>
        <form id="leadForm" novalidate>
          <input class="form-control" id="fullName" name="fullName" placeholder="Full Name" required />
          <input class="form-control" id="email" name="email" type="email" placeholder="Email" required />
          <input class="form-control" id="phone" name="phone" placeholder="Phone (10 digits)" required />
          <select class="form-control" id="state" name="state" required>
            <option value="">Select State</option>
            <option>Punjab</option><option>Haryana</option><option>Delhi</option><option>Other</option>
          </select>
          <select class="form-control" id="course" name="course" required>
            <option value="">Course Interested</option>
          </select>
          <select class="form-control" id="intake" name="intake" required>
            <option value="">Intake Year</option>
            <option>2025</option><option>2026</option>
          </select>
          <label class="small"><input type="checkbox" id="consent" /> I agree to be contacted</label>
          <button class="btn" type="submit">Apply Now</button>
        </form>
        <div id="msg"></div>
      </aside>
    </main>
  </div>

  <div id="modalFees" class="modal" role="dialog" aria-hidden="true">
    <div class="panel">
      <h3>Course-wise Fees</h3>
      <div id="feesContent">Loading...</div>
      <p><a id="closeModal" class="btn">Close</a></p>
    </div>
  </div>

<script>
const API_BASE = "/api"; // relative to same server
const UNIVERSITY_ID = "uni-1"; // this page's university id

function $(s){ return document.querySelector(s) }
function showMsg(type, text){
  const msg = $('#msg');
  msg.innerHTML = '<div class="'+(type==='ok'?'success':'error')+'">'+text+'</div>';
  setTimeout(()=> msg.innerHTML = '', 5000);
}

async function loadUniversity(){
  try{
    const res = await fetch(API_BASE + '/universities/' + UNIVERSITY_ID);
    const uni = await res.json();
    $('#overview').textContent = uni.overview;
    $('#placements').textContent = uni.placements.top_companies.join(', ') + ' — Avg: ' + uni.placements.avg_package;
    $('#facilities').textContent = uni.facilities.join(', ');
    const coursesList = $('#coursesList');
    const courseSelect = $('#course');
    uni.courses.forEach(c=>{
      const li = document.createElement('li');
      li.textContent = c.name + ' — ' + c.duration;
      coursesList.appendChild(li);
      const opt = document.createElement('option');
      opt.value = c.code;
      opt.textContent = c.name;
      courseSelect.appendChild(opt);
    });
  }catch(e){
    console.error(e);
    $('#overview').textContent = 'Failed to load data.';
  }
}

$('#feesBtn').addEventListener('click', async (ev)=>{
  ev.preventDefault();
  $('#modalFees').style.display = 'flex';
  try{
    const res = await fetch(API_BASE + '/universities/' + UNIVERSITY_ID);
    const uni = await res.json();
    const content = uni.courses.map(c => '<div><strong>'+c.name+'</strong><br/>Fees: ₹'+c.fee_min.toLocaleString()+' - ₹'+c.fee_max.toLocaleString()+'</div><hr/>').join('');
    $('#feesContent').innerHTML = content;
  }catch(e){
    $('#feesContent').textContent = 'Failed to load fees.';
  }
});
$('#closeModal').addEventListener('click', e=>{ e.preventDefault(); $('#modalFees').style.display = 'none' });

$('#leadForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = {
    fullName: $('#fullName').value.trim(),
    email: $('#email').value.trim(),
    phone: $('#phone').value.trim(),
    state: $('#state').value,
    course: $('#course').value,
    intake: $('#intake').value,
    consent: $('#consent').checked,
    university: UNIVERSITY_ID
  };
  if(!/^\d{10}$/.test(data.phone)){ showMsg('err', 'Phone must be 10 digits'); return; }
  if(!data.consent){ showMsg('err', 'Consent required'); return; }
  try{
    const res = await fetch(API_BASE + '/leads', {
      method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data)
    });
    const j = await res.json();
    if(j.ok){
      showMsg('ok', 'Thank you! We received your request.');
      $('#leadForm').reset();
    } else showMsg('err', 'Submission failed.');
  }catch(err){
    console.error(err);
    showMsg('err','Network error.');
  }
});

loadUniversity();
</script>
</body>
</html>
